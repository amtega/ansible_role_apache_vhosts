{{ ansible_managed | comment }}

<VirtualHost {{ apache_vhosts_vhost.addr | default(apache_vhosts_defaults.addr) }}:{{ apache_vhosts_vhost.port | default(apache_vhosts_defaults.port) }}>
  ServerName {{ apache_vhosts_vhost.server_name | default(apache_vhosts_defaults.server_name) }}

{% for include in apache_vhosts_vhost.includes | default(apache_vhosts_defaults.includes) %}
  Include {{ include }}
{% endfor %}

  RewriteEngine {{ (apache_vhosts_vhost.rewrite_engine | default(apache_vhosts_defaults.rewrite_engine)) | ternary("On", "Off") }}
{% if apache_vhosts_vhost.rewrite_engine | default(apache_vhosts_defaults.rewrite_engine) %}
{% for rule in apache_vhosts_vhost.rewrite_rules | default(apache_vhosts_defaults.rewrite_rules) %}
  RewriteRule {{ rule }}
{% endfor %}
{% endif %}

{% for proxy_pass in apache_vhosts_vhost.proxy_pass | default(apache_vhosts_defaults.proxy_pass) %}
  ProxyPass {{ proxy_pass }}
{% endfor %}

{% for header in apache_vhosts_vhost.headers | default(apache_vhosts_defaults.headers) %}
  Header {{ header }}
{% endfor %}

{% if apache_vhosts_vhost.balancer | default(apache_vhosts_defaults.balancer) is defined %}
  <Proxy balancer://{{ apache_vhosts_vhost.balancer.name | default(apache_vhosts_defaults.balancer.name) }}>
{% for member in apache_vhosts_vhost.balancer.members | default(apache_vhosts_defaults.balancer.members) %}
    BalancerMember {{ member }}
{% endfor %}
    ProxySet lbmethod={{ apache_vhosts_vhost.balancer.lbmethod | default(apache_vhosts_defaults.balancer.lbmethod) }} stickysession={{ apache_vhosts_vhost.balancer.sticky_session | default(apache_vhosts_defaults.balancer.sticky_session) }}
{% endif %}
  </Proxy>

{% if apache_vhosts_vhost.error_log | default(apache_vhosts_defaults.error_log) is defined %}
  ErrorLog {{ apache_vhosts_vhost.error_log | default(apache_vhosts_defaults.error_log) }}
{% endif %}
</VirtualHost>
